.\" Automatically generated by Pandoc 2.9.2.1
.\"
.TH "tbresource" "1" "2020-06-02" "Tbricks" "tbresource man page"
.hy
.SH NAME
.PP
\f[C]tbresource\f[R] \[en] manages file system resources.
.SH SYNOPSIS
.PP
\f[C]tbresource\f[R] [\f[C]help\f[R]]
.PP
\f[C]tbresource create\f[R] <resource>
.PP
\f[C]tbresource create\f[R] [\f[C]-f\f[R]] <filename> <resource>
[<type>]
.PP
\f[C]tbresource destroy\f[R] [\f[C]-fv\f[R]] [<resource>[
<resource>]\&...]
.PP
\f[C]tbresource edit\f[R] <resource> [<editor>]
.PP
\f[C]tbresource list\f[R] [<property>=<value>]
.PP
\f[C]tbresource set\f[R] [<property>=<value> <resource>]
.PP
\f[C]tbresource clear\f[R] [<property>[,<property>\&...] <resource>]
.PP
\f[C]tbresource get\f[R] [\f[C]-r\f[R] <revision>] <resource>
.PP
\f[C]tbresource get\f[R] [<property>[,<property>]\&...] [<resource>[
<resource>]\&...]
.PP
\f[C]tbresource import\f[R] [\f[C]-f\f[R]] <filename> <resource>
[<type>]
.PP
\f[C]tbresource export\f[R] [\f[C]-r\f[R] <revision>] <resource>
[<filename>|<directory>]
.PP
\f[C]tbresource diff\f[R] <resource> <revision1>[ <revision2>\&...]
.PP
\f[C]tbresource history\f[R]
.PP
\f[C]tbresource log\f[R] [<property>[,<property>]\&...] <resource>
.SH DESCRIPTION
.PP
The \f[C]tbresource\f[R] tool is utilized for managing file resources
used by services/components/systems.
Uploading a file to the Distribution Center using
\f[C]tbresource import\f[R] will ensure that it is automatically
distributed by the administrative infrastructure to all relevant nodes
in the system.
.PP
Every resource has a type, which is usually automatically detected by
the \f[C]tbresource\f[R] tool as a file is uploaded into the system.
.PP
Resources are stored on each local node using them in the
<persistence_root>\f[C]/resources/\f[R]<resource_identifier><file_name>
directory.
.SS Identifiers
.PP
Please see \f[C]tbintro\f[R](1) for information about the identifiers
used.
.SS Properties
.PP
Each resource has a set of properties that are used to provide specific
behavior.
.PP
The identifier provides a persistent unique identifier (a UUID), that is
assigned at creation time.
It is typically used for cross references and/or scripts which require
that the identifier will not change.
The identifier cannot be changed by a user.
.PP
\f[B]The following properties are read-only and cannot be changed by a
user:\f[R]
.TP
\f[B]\f[CB]identifier\f[B]\f[R]
The UUID uniquely identifying this resource.
.TP
\f[B]\f[CB]file_name\f[B]\f[R]
The filename originally uploaded using \f[C]tbresource import\f[R].
.TP
\f[B]\f[CB]size\f[B]\f[R]
The size in bytes of the file.
This property is automactically set when the resource is uploaded using
\f[C]tbresource import\f[R].
.TP
\f[B]\f[CB]path\f[B]\f[R]
The path of the extracted resource on the node machine.
It is set to the
<persistence_root>\f[C]/resources/\f[R]<resource_identifier><file_name>
node.
.PP
\f[B]The following properties can be set by a user:\f[R]
.TP
\f[B]\f[CB]short_name\f[B]\f[R]
A name that is used to identify the resource.
.TP
\f[B]\f[CB]mime_type\f[B]\f[R]
Defines which data type the resource represents.
.RS
.PP
The resource type is based on and corresponds to the MIME Media Types as
defined in RFC 2046 (http://tools.ietf.org/html/rfc2046) and RFC 3023
(http://tools.ietf.org/html/rfc3023).
.PP
The type is automatically detected and set (if not previously set) when
a file is uploaded using \f[C]tbresource import\f[R], but can be changed
by a user in those extremely rare cases where automatic detection
failed.
.RE
.TP
\f[B]\f[CB]systems\f[B]\f[R]
A comma-separated list of system identifiers that use this resource.
.TP
\f[B]\f[CB]components\f[B]\f[R]
A comma-separated list of component identifiers that use this resource.
.TP
\f[B]\f[CB]services\f[B]\f[R]
A comma-separated list of service identifiers that use this resource.
.PP
\f[B]The following properties specify display attributes of the
resource:\f[R]
.TP
\f[B]\f[CB]name\f[B]\f[R]
The display name of the resource.
.RS
.PP
By default, the name is set to be the same as the filename.
.RE
.TP
\f[B]\f[CB]description\f[B]\f[R]
The detailed description of the resource and its intended usage.
.RS
.PP
By default, the description is not set.
.RE
.PP
\f[B]The following properties control automatic downloading of resource
data from external sources (via HTTP, FTP, etc.).\f[R]
.TP
\f[B]\f[CB]download_url\f[B]\f[R]
Uniform Resource Locator (URL) of external resource data source.
.RS
.PP
The syntax is the following:
protocol://[user:passwd\[at]]host.domain.com[:port]/path/to/file.
See RFC 3986 (http://tools.ietf.org/html/rfc3986) for details.
.PP
Format specifiers accepted by strftime(3) function can be used in the
URL.
.PP
Currently HTTP, FTP, and SFTP protocols are supported.
.PP
For example: ftp://john:passwd\[at]venue_host.com/%Y%m%d-ird_data.txt
.RE
.TP
\f[B]\f[CB]download_days\f[B]\f[R]
Days of week when the resource data should be downloaded.
Days are in timezone specified in the \f[C]download_timezone\f[R]
property, see below.
.RS
.PP
The following days are allowed:
.IP \[bu] 2
Everyday - All days
.IP \[bu] 2
Weekday - Monday-Friday
.IP \[bu] 2
Never - Never
.IP \[bu] 2
Monday,Tuesday,Wednesday,Thursday,Friday,Saturday,Sunday - The specified
day
.RE
.TP
\f[B]\f[CB]download_time\f[B]\f[R]
Time of day when the resource data should be downloaded in 24-hour
format.
Time is in timezone specified in the \f[C]download_timezone\f[R]
property, see below.
.RS
.PP
For example: 08:00
.RE
.TP
\f[B]\f[CB]download_timezone\f[B]\f[R]
Timezone in which download_days and download_time are specified.
.RS
.PP
For example: Europe/London
.RE
.TP
\f[B]\f[CB]download_options\f[B]\f[R]
Various options that control download process.
.RS
.PP
Options are specified in the following format: option=value.
Several options are separated by spaces.
If value of the option has boolean type, then \f[C]=value\f[R] part can
be omitted for the \f[C]true\f[R] value.
.PP
\f[B]The following options are currently supported:\f[R]
.IP \[bu] 2
ftp-epsv[=yes/no] - Use EPSV FTP command.
See RFC 2428 (http://tools.ietf.org/html/rfc2428) for details.
.IP \[bu] 2
ftp-eprt[=yes/no] - Use EPRT FTP command.
See RFC 2428 (http://tools.ietf.org/html/rfc2428) for details.
.IP \[bu] 2
ftp-passive[=yes/no] - Use FTP passive mode.
See RFC 959 (http://tools.ietf.org/html/rfc959) for details.
.IP \[bu] 2
ftp-port=host:port[-port] - For FTP active mode this specifies IP
address and port for server to connect back.
See PORT FTP command in RFC 959 (http://tools.ietf.org/html/rfc959).
.IP \[bu] 2
local-port=port[-port] - Used to specify local port (or port range) for
outgoing connections.
.IP \[bu] 2
socks4=host[:port] - Used to specify SOCKS4 proxy address.
.IP \[bu] 2
timeout=secs - Download timeout specified in seconds.
0 means no timeout.
Default value is 1 hour (3600)
.IP \[bu] 2
insecure[=yes/no] - Do not check peer SSL certificate when downloading
over HTTPS.
Default is to check.
.RE
.TP
\f[B]\f[CB]download_script\f[B]\f[R]
Name of the resource which will be used as a custom download script.
.RS
.PP
This script will be run by Distribution Center according to the download
schedule.
.PP
DC assumes the script will send downloaded data to its standard output
and exit with the 0 return code.
Errors can be printed to the standard error output.
.PP
Target resource properties are accessible in script via environment
variables (e.g.\ \f[C]download_url\f[R]).
.PP
When assigning a value that starts with #, this value is interpreted as
a script body.
.RE
.TP
\f[B]\f[CB]download_script_timeout\f[B]\f[R]
Maximum amount of time (in minutes) that download script is allowed to
run.
.RS
.PP
Default value is 30 min.
.RE
.SH SUBCOMMANDS
.PP
All subcommands that modify state are logged persistently to the history
log in their original form.
.PP
The \f[C]tbresource\f[R] command provides subcommands to create and
destroy resources, as well as getting and setting their properties.
.PP
\f[B]The following subcommands are supported:\f[R]
.TP
\f[B]\f[CB]tbresource\f[B]\f[R] [\f[B]\f[CB]help\f[B]\f[R]]
Displays usage of the tool, including available subcommands and options.
.TP
\f[B]\f[CB]tbresource create\f[B]\f[R] <resource>
Creates a new Tbricks resource with the specified short name.
Does not set resource mime type.
.TP
\f[B]\f[CB]tbresource create\f[B]\f[R] [\f[B]\f[CB]-f\f[B]\f[R]] <filename> <resource> [<type>]
Creates a new Tbricks resource with the spcified short name and uploads
the specified file as the backing store for the resource.
.RS
.PP
Mime type will be automatically detected if type is not specified.
\f[C]--force\f[R] or \f[C]-f\f[R] forces resource upload even if
validation errors occurred.
.RE
.TP
\f[B]\f[CB]tbresource destroy\f[B]\f[R] [\f[B]\f[CB]-fv\f[B]\f[R]] [<resource>[ <resource>]\&...]
Destroys the given resource and removes it permanently.
\f[C]tbresource\f[R] checks whether any valid references remains for the
resource and will fail destroying the resource if such exists.
.RS
.TP
\f[B]\f[CB]-f\f[B]\f[R]
Use force.
Removes the resources even if there are outstanding valid references to
existing services, components, or systems.
.TP
\f[B]\f[CB]-v\f[B]\f[R]
Provide verbose information about the operation.
.RE
.TP
\f[B]\f[CB]tbresource edit\f[B]\f[R] <resource> [<editor>]
Allows direct editing of text resources in custom editors.
.RS
.PP
Automatically reflects the changes to the resource in the infrastructure
without requiring download/upload cycles.
.PP
The editor to use will be selected according to the following order of
precedence:
.IP "1." 3
The editor specified on the command line.
.IP "2." 3
The editor specified by the TBRICKS_EDITOR environment variable.
.IP "3." 3
The editor specified by the EDITOR environment variable.
.IP "4." 3
The `nano' editor supplied with Tbricks system.
.RE
.TP
\f[B]\f[CB]tbresource list\f[B]\f[R] [<property>=<value>]
Lists all available resources.
.RS
.PP
If the property is specified, only resources with the given property
value will be returned.
The systems, components, and services properties are specially treated
to allow matching of subexpressions, i.
e.
\f[C]tbresource list systems=prod\f[R] will match all resources which
has \f[C]prod\f[R] as a system listed anywhere in the comma-separated
list.
This is particularly useful for listing all resources belonging to a
specific system or component.
.RE
.TP
\f[B]\f[CB]tbresource set\f[B]\f[R] [<property>=<value> <resource>]
If the property is not specified, this lists all possible properties
that can be set.
Otherwise sets the property to the given value for the resource.
.RS
.PP
Only some properties can be edited.
See the \f[B]Properties\f[R] section for more information on available
properties and their acceptable values.
.RE
.TP
\f[B]\f[CB]tbresource clear\f[B]\f[R] [<property>[,<property>\&...] <resource>]
Clears values for the given properties for the specified resource.
.RS
.PP
If the property is not specified, this will list all possible properties
that can be cleared.
.RE
.TP
\f[B]\f[CB]tbresource get\f[B]\f[R] [\f[B]\f[CB]-r\f[B]\f[R] <revision>] <resource>
Displays status and configuration information for the resource.
.RS
.PP
\f[C]-r\f[R]|\f[C]--revision\f[R]=<revision> provides specific revision.
.RE
.TP
\f[B]\f[CB]tbresource get\f[B]\f[R] [<property>[,<property>]\&...] [<resource>[ <resource>]\&...]
Displays status and configuration information for the resource or
available properties if the resource is not specified.
.TP
\f[B]\f[CB]tbresource import\f[B]\f[R] [\f[B]\f[CB]-f\f[B]\f[R]] <filename> <resource> [<type>]
Uploads the specified filename as the backing store for the resource.
.RS
.PP
Mime type will be automatically detected if [type] is not specified.
\f[C]--force\f[R] or \f[C]-f\f[R] forces resource upload even if
validation errors occurred.
.RE
.TP
\f[B]\f[CB]tbresource export\f[B]\f[R] [\f[B]\f[CB]-r\f[B]\f[R] <revision>] <resource> [<filename>|<directory>]
Downloads the specified resource to the current directory using the
original filename.
If the optional filename parameter is provided, the resource will be
saved under this optional name.
.RS
.PP
If \[lq]-\[rq] is specified as a filename, the resource will be output
to stdout.
.PP
\f[C]-r\f[R]|\f[C]--revision\f[R]=<revision> provides specific revision.
.RE
.TP
\f[B]\f[CB]tbresource diff\f[B]\f[R] <resource> <revision1>[ <revision2>\&...]
Displays differences between two resource revisions.
If <revision2> parameter is not specified, differences between latest
revision and <revision1> will be shown.
If <revision2> parameter is specififed, differences between <revision1>
and <revision2> will be shown.
.TP
\f[B]\f[CB]tbresource history\f[B]\f[R]
Displays the history of all \f[C]tbresource\f[R] commands successfully
issued that affect persisted state.
The history output provides information about which node, what user, and
what command was issued at what point in time.
.TP
\f[B]\f[CB]tbresource log\f[B]\f[R] [<property>[,<property>]\&...] <resource>
Displays the history of properties changes for resource.
.PP
#OPTIONS
.TP
\f[B]\f[CB]--parsable\f[B]\f[R]
When used in conjunction with subcommands, the output is displayed in a
machine-parsable format.
.SH EXAMPLES
.PP
\f[B]Creating a new resource\f[R]
.IP
.nf
\f[C]
   $ tbresource create \[ti]/app_config.xml config
   Detecting type: OK \[dq]application/x-catalys-app-config+xml\[dq]
   Validating resource: OK
   Creating resource \[dq]config\[dq]: OK
   Importing file: OK
   $
\f[R]
.fi
.PP
\f[B]Destroying a resource\f[R]
.IP
.nf
\f[C]
   $ tbresource destroy res8
   $
\f[R]
.fi
.PP
\f[B]Listing all available resources\f[R]
.IP
.nf
\f[C]
   $ tbresource list

             Name             Associations      Kind                       Type
   -----------------------------------------------------------------------------------------------
      internal_tickrules         kb_TRD         [com]      application/x-trading-information+xml
       bats_tr_resource        mifid_bats       [com]       application/x-bats-boe-config+xml
             AED                mifid_ce        [com]          application/x-calendar+xml
   -----------------------------------------------------------------------------------------------
   $
\f[R]
.fi
.PP
\f[B]Setting a property\f[R]
.IP
.nf
\f[C]
   $ tbresource set components=\[dq]com8,com9\[dq] res7
   $
\f[R]
.fi
.PP
\f[B]Getting a property\f[R]
.IP
.nf
\f[C]
   $ tbresource get mime_type example
   short_name : example
    mime_type : application/x-venue-priority+xml
   $
\f[R]
.fi
.PP
\f[B]Getting all properties\f[R]
.IP
.nf
\f[C]
   $ tbresource get example
    short_name : example
    identifier : eb45c386-6e14-11e7-8df0-775d81ac5d13
     mime_type : application/x-catalys-app-config+xml
     file_name : config.xml
          size : 305
   upload_time : 2017-07-21 16:02:58.372469 MSK
      revision : 2
\f[R]
.fi
.PP
\f[B]Getting all properties in a specific revision\f[R]
.IP
.nf
\f[C]
   tbresource get --revision=4 example
    short_name : example
    identifier : 5cd49202-08c1-11e7-a030-a61f3eb14eb6
     mime_type : application/x-unknown
     file_name : 67d1eb00-08c1-11e7-b3d0-a6b9885c39ef
          size : 12
   upload_time : 2017-03-14 14:21:21.967502 GMT
      revision : 4
\f[R]
.fi
.PP
\f[B]Updating the file for a resource\f[R]
.IP
.nf
\f[C]
   $ tbresource import instruments.xml resource
   Detecting type: OK \[dq]application/x-instrument-reference-data+xml\[dq]
   Validating resource: OK
   Importing file: OK
   $
\f[R]
.fi
.PP
\f[B]Retrieving the file for a resource into a specific directory\f[R]
.IP
.nf
\f[C]
   $ tbresource export res8 /tmp
   Resouce res8 exported to /tmp/instruments.xml (16872 bytes)
   $
\f[R]
.fi
.PP
\f[B]Dumping a resource to the console\f[R]
.IP
.nf
\f[C]
   $ tbresource export res8 -
   .
   .
   .
   $
\f[R]
.fi
.PP
\f[B]Getting history of properties changes\f[R]
.IP
.nf
\f[C]
   $ tbresource log res8
   ------------------------------------------------------------
   revision 1 | 2017-05-02 12:43:24.252786 UTC
   + short_name : test2

   ------------------------------------------------------------
   revision 2 | 2017-05-02 12:50:05.165847 UTC | file changed
   +   file_name : dd5bd6a2-2f35-11e7-8600-28b6268cc3df
   +   mime_type : application/x-unknown
   +        size : 3
   + upload_time : 2017-05-02 13:50:05.165847 IST
\f[R]
.fi
.PP
\f[B]Getting history of resource changes by property\f[R]
.IP
.nf
\f[C]
   $ tbresource log short_name,mime_type resource
   ------------------------------------------------------------
   revision 1 | 2017-03-14 14:20:23.723473 UTC
   + short_name : old_resource_name

   ------------------------------------------------------------
   revision 2 | 2017-03-14 14:20:42.161938 UTC | file changed
   +   mime_type : application/x-unknown

   ------------------------------------------------------------
   revision 5 | 2017-04-13 07:37:07.353660 UTC
   - short_name : old_resource_name
   + short_name : resource
\f[R]
.fi
.PP
\f[B]Setting download script in a tool property\f[R]
.IP
.nf
\f[C]
   $ tbresource create my_resource
   $ tbresource set download_url=http://www.ecb.europa.eu/stats/eurofxref/eurofxref-daily.xml my_resource
   $ tbresource set download_script=\[aq]#wget -qO- $download_url\[aq] my_resource
\f[R]
.fi
.SH EXIT STATUS
.PP
The following exit values are returned:
.IP \[bu] 2
0: Successful completion.
.IP \[bu] 2
1: An error occurred.
.IP \[bu] 2
2: Invalid command line options were specified.
.SH SEE ALSO
.PP
\f[C]tbintro\f[R](1), \f[C]tbaudit\f[R](1), \f[C]tbcomponent\f[R](1),
\f[C]tbcore\f[R](1), \f[C]tblog\f[R](1), \f[C]tbnode\f[R](1),
\f[C]tbrelease\f[R](1), \f[C]tbresource\f[R](1), \f[C]tbservice\f[R](1),
\f[C]tbsubsystem\f[R](1), \f[C]tbsystem\f[R](1), \f[C]tbuser\f[R](1)
