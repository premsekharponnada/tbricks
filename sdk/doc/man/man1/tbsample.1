.\" Automatically generated by Pandoc 2.9.2.1
.\"
.TH "tbsample" "1" "2020-06-02" "Tbricks" "tbsample man page"
.hy
.SH NAME
.PP
\f[C]tbsample\f[R] \[en] captures backtraces of system components.
.SH SYNOPSIS
.PP
\f[C]tbsample\f[R] <component_name>|<process_pid> [\f[C]-t\f[R]
<time-out>] [\f[C]-F\f[R] <frequency>] [\f[C]-m\f[R] <mmap_pages>]
[\f[C]--no_flame_graph\f[R]] [\f[C]--leave_tbricks\f[R]]
[\f[C]--pager\f[R]] [\f[C]--dry_run\f[R]] [\f[C]--mutex_contention\f[R]]
.PP
\f[C]tbsample\f[R] [\f[C]help\f[R]]
.SH DESCRIPTION
.PP
The \f[C]tbsample\f[R] tool is used to capture performance analysis
information of running system components or any process using the Linux
perf tool as the underlying infrastructure.
Its results are useful to understand why a process uses a large amount
of CPU and are excellent information to attach to bug reports for such
occurrences.
.PP
\f[C]tbsample\f[R] collects backtraces (or simply stacks) with some
frequency specified in command line or chosen automatically depending on
the current average CPU load of the target process.
Then collected stacks processed and results saved in the current
directory in three files which correspond to different representations
of the same data: flat, graph, and svg.
SVG file is interactive and can be opened in browser, it contains rich
information and very user friendly.
.SH OPTIONS
.PP
Without arguments, \f[C]tbsample\f[R] will work for 10 seconds, sampling
frequency is selected depending on the current average CPU load of the
target process.
Defaults can be changed with the following options:
.TP
\f[B]\f[CB]-t\f[B]\f[R]
Time-out in seconds.
It is not recommended to use time-outs longer than 30 seconds
.TP
\f[B]\f[CB]-F\f[B]\f[R]
Frequency in Hz.
For advanced users only.
High values can seriously affect system performance, use it with
caution.
Automatically selected frequency is in range from 100 Hz (high CPU load)
to 1000 Hz (low CPU load)
.TP
\f[B]\f[CB]--java\f[B]\f[R]|\f[B]\f[CB]-j\f[B]\f[R]
Perform sampling on Java apps that could be running on the engine.
Requires that JVM configuration is started with
\f[C]-XX:+PreserveFramePointer\f[R] and
\f[C]-XX:+StartAttachListener\f[R] flags (default).
Only works with JVM version 8u60 or greater.
.TP
\f[B]\f[CB]-m\f[B]\f[R]
Number of mmap data pages (must be a power of two).
Work only with the \f[C]--mutex_contention\f[R] option.
Default is 32768 (128M).
.TP
\f[B]\f[CB]--leave_tbricks\f[B]\f[R]
By default, the \f[C]tbricks::\f[R] namespace prefix is cut out.
With this option, it will be untouched.
.TP
\f[B]\f[CB]--pager\f[B]\f[R]
Besides files, graph result will be shown in terminal using pager.
.TP
\f[B]\f[CB]--dry_run\f[B]\f[R]
Print commands without execution.
.TP
\f[B]\f[CB]--mutex_contention\f[B]\f[R]
Collect mutex contention backtraces.
Generate two flamegraphs: One contains all backtraces, another excludes
backtraces with \f[C]sem_wait\f[R] on top.
.SH EXIT STATUS
.PP
The following exit values are returned:
.IP \[bu] 2
0: Successful completion.
.IP \[bu] 2
1: An error occurred.
.IP \[bu] 2
2: Invalid command line options were specified.
.SH SEE ALSO
.PP
\f[C]tbintro\f[R](1), \f[C]tbaudit\f[R](1), \f[C]tbcomponent\f[R](1),
\f[C]tbcore\f[R](1), \f[C]tblog\f[R](1), \f[C]tbnode\f[R](1),
\f[C]tbrelease\f[R](1), \f[C]tbresource\f[R](1), \f[C]tbservice\f[R](1),
\f[C]tbsubsystem\f[R](1), \f[C]tbsystem\f[R](1), \f[C]tbuser\f[R](1)
