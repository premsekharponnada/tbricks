.\" Automatically generated by Pandoc 2.9.2.1
.\"
.TH "tbsystem" "1" "2020-06-02" "Tbricks" "tbsystem man page"
.hy
.SH NAME
.PP
\f[C]tbsystem\f[R] \[en] configures logical Tbricks systems.
.SH SYNOPSIS
.PP
\f[C]tbsystem\f[R]
.PP
\f[C]tbsystem\f[R] [\f[C]help\f[R]]
.PP
\f[C]tbsystem create\f[R] <system>
.PP
\f[C]tbsystem create\f[R] <system> <package> [\f[C]-p\f[R] <prefix>]
<node1>[ <node2>]
.PP
\f[C]tbsystem destroy\f[R] <system>
.PP
\f[C]tbsystem list\f[R]|\f[C]ls\f[R] [<system>]
.PP
\f[C]tbsystem info\f[R] <system>
.PP
\f[C]tbsystem set\f[R] <property>=<value> <system>
.PP
\f[C]tbsystem clear\f[R] <property>[,<property>\&...] <system>
.PP
\f[C]tbsystem get\f[R] <property>[,<property>\&...] <system>
.PP
\f[C]tbsystem start\f[R] [\f[C]-w\f[R] <time>] [\f[C]-f\f[R]] <system>
.PP
\f[C]tbsystem stop\f[R] [\f[C]-w\f[R] <time>] [\f[C]-f\f[R]] <system>
.PP
\f[C]tbsystem restart\f[R] [\f[C]-w\f[R] <time>] [\f[C]-f\f[R]] <system>
.PP
\f[C]tbsystem upgrade\f[R] [\f[C]-n\f[R]] <system> <package>
.PP
\f[C]tbsystem history\f[R]
.SH DESCRIPTION
.PP
The \f[C]tbsystem\f[R] command configures logical Tbricks systems.
A system is a logical collection of Tbricks services that is accessed as
one entity from an end-user perspective.
The tbsystem tool can be used to start/stop all services belonging to a
specific system.
.SS Identifiers
.PP
Please see \f[C]tbintro\f[R](1) for information about the identifiers
used.
.SS Properties
.PP
Every system has a set of properties that are accessible to the services
in the system.
The identifier provides a persistent unique identifier (an UUID), that
is assigned at creation time.
It is typically used for cross references and/or scripts which require
that the identifier does not change.
The identifier cannot be changed by the user.
.TP
\f[B]\f[CB]identifier\f[B]\f[R]
The UUID uniquely identifying the system.
.TP
\f[B]\f[CB]release\f[B]\f[R]
A reference to the release being used by the system.
This is automatically updated during an upgrade process.
.PP
\f[B]The following properties can be set by a user:\f[R]
.TP
\f[B]\f[CB]short_name\f[B]\f[R]
A short name that is used to identify the system.
The following properties specify display attributes for the system.
These and the remaining properties below can be set.
.TP
\f[B]\f[CB]name\f[B]\f[R]
The display name of the system, used when listing available systems and
in the login panel of the Tbricks X-Ray Frontend.
The default name is \f[B]System <short_name>\f[R].
.TP
\f[B]\f[CB]description\f[B]\f[R]
The detailed description of the system and its intended usage.
By default it is empty.
.PP
\f[B]The following properties specify logging settings:\f[R]
.TP
\f[B]\f[CB]log_level_persisted\f[B]\f[R]
This is the level of which logs of components/services are persisted.
The available levels are: \f[C]off\f[R], \f[C]critical\f[R],
\f[C]error\f[R], \f[C]warning\f[R], \f[C]notice\f[R], \f[C]status\f[R],
\f[C]debug\f[R], and \f[C]dump\f[R].
By default, the log level to persist is \f[C]status\f[R].
.TP
\f[B]\f[CB]log_level_flush\f[B]\f[R]
This is the level of which logs of component are flushed after being
persisted.
For list of available levels, see \f[C]log_level_persisted\f[R] above.
.TP
\f[B]\f[CB]unlimited_logs\f[B]\f[R]
Unlimited log messages will be locally cached in-memory before the
internal logging framework start discarding new low-priority log
messages.
This limit is in reality only hit when running tblog with the debug/dump
or fulldump severity levels.
If the disk subsystem keeps up this should never happen.
When the service catches up to half this level, it will stop discarding
messages.
.RS
.PP
Default is \f[C]false\f[R], up to 50.000 log entries are buffered
internally.
.RE
.SH SUBCOMMANDS
.PP
All subcommands that modify state are logged persistently to the history
log in their original form.
The \f[C]tbsystem\f[R] command provides subcommands to create and
destroy systems, add services to systems, and provide information about
the systems.
.PP
\f[B]The following subcommands are supported:\f[R]
.TP
\f[B]\f[CB]tbsystem\f[B]\f[R] [\f[B]\f[CB]help\f[B]\f[R]]
Displays usage of the tool, including available subcommands and options.
.TP
\f[B]\f[CB]tbsystem create\f[B]\f[R] <system>
Creates a new Tbricks system with the specified short name.
.TP
\f[B]\f[CB]tbsystem create\f[B]\f[R] <system> <package> [\f[B]\f[CB]-p\f[B]\f[R] <prefix>] <node1>[ <node2>]
Creates a new Tbricks system with the specified short name, optionally
containing a set of essential core components.
Core components will be created on platform specified in the package
argument.
The tool validates that the system name is unique, and if not, an error
will be returned and the user is expected to select a different name.
When the optional node names are specified on the command line, the
utility will additionally create a set of core components based on the
specified package and bound to the specified nodes according to the
scheme shown below.
Each new component name will be prefixed with the string given using the
\f[C]-p\f[R] option, or \f[C]prd_\f[R] if that option is omitted.
.RS
.PP
\f[B]Default components layout for one node\f[R]
.IP
.nf
\f[C]
 Name          Type
 <prefix>mx1   Metadata
 <prefix>tp1   Trade Persistence
 <prefix>op1   Order Persistence
 <prefix>is1   Instrument
 <prefix>xe1   XRayEngine
 <prefix>xp1   XRayPersistence
 <prefix>se1   Strategy Engine
 <prefix>ce1   Calculation Engine
 <prefix>ae1   Accessory Engine
 <prefix>ve1   Visualization Engine
\f[R]
.fi
.PP
\f[B]Default components layout for two nodes\f[R]
.IP
.nf
\f[C]
 Name          Type                   Node #
 <prefix>mx1   Metadata               1
 <prefix>is1   Instrument             1
 <prefix>xe1   XRayEngine             1
 <prefix>ve1   Visualization Engine   1
 <prefix>se1   Strategy Engine        1
 <prefix>tp1   Trade Persistence      2
 <prefix>op1   Order Persistence      2
 <prefix>xp1   XRayPersistence        2
 <prefix>ce1   Calculation Engine     2
 <prefix>ae1   Accessory Engine       2
 <prefix>xe2   XRayEngine             2
\f[R]
.fi
.RE
.TP
\f[B]\f[CB]tbsystem destroy\f[B]\f[R] <system>
Destroys the given system and removes it permanently.
If there are services still configured for the system, this command will
return with an error.
.TP
\f[B]\f[CB]tbsystem list\f[B]\f[R]|\f[B]\f[CB]ls\f[B]\f[R] [<system>]
Lists all available systems configured or a single system if the
optional argument is provided.
.TP
\f[B]\f[CB]tbsystem info\f[B]\f[R] <system>
Prints additional information about system, e.g.\ resource associations,
subsystems.
.TP
\f[B]\f[CB]tbsystem set\f[B]\f[R] <property>=<value> <system>
Sets the property to the given value for the system.
If the property is not specified, this will list all possible properties
that can be set.
Only some properties can be edited.
See the \f[B]Properties\f[R] section for more information on what
properties can be set and acceptable values.
.TP
\f[B]\f[CB]tbsystem clear\f[B]\f[R] <property>[,<property>\&...] <system>
Clears values for the given properties for the specified system.
If the property is not specified, this will list all possible properties
that can be cleared.
.TP
\f[B]\f[CB]tbsystem get\f[B]\f[R] <property>[,<property>\&...] <system>
Displays status and configuration information for either all systems or
for the specified system.
If the system is not specified, all possible properties are listed
instead.
.TP
\f[B]\f[CB]tbsystem start\f[B]\f[R] [\f[B]\f[CB]-w\f[B]\f[R] <time>] [\f[B]\f[CB]-f\f[B]\f[R]] <system>
Starts all services in the specified system.
By default, the command waits for the system has been started.
.RS
.PP
\f[C]-w\f[R] option is used to unconditionally release execution flow
after the time is out even in case system is still starting.
The time value has to be specified in human readable form like
\f[C]1h\f[R] or \f[C]1m  30s\f[R].
The following abbreviations are supported: w, d, h, m, s.
Default value is 61 minutes.
.PP
\f[C]-f\f[R] option forces command to be executed in non-interactive
mode (no confirmations are requested from user)
.RE
.TP
\f[B]\f[CB]tbsystem stop\f[B]\f[R] [\f[B]\f[CB]-w\f[B]\f[R] <time>] [\f[B]\f[CB]-f\f[B]\f[R]] <system>
Stops all services in the specified system.
By default the command waits for the system has been stopped.
.RS
.PP
\f[C]-w\f[R] option is used to unconditionally release execution flow
after the time is out even in case system is still starting.
The time value has to be specified in human readable form like
\f[C]1h\f[R] or \f[C]1m  30s\f[R].
The following abbreviations are supported: w, d, h, m, s.
Default value is 61 minutes.
.PP
\f[C]-f\f[R] forcibly shuts down the services and the command to be
executed in non-interactive mode (no confirmations are requested from a
user).
.RE
.TP
\f[B]\f[CB]tbsystem restart\f[B]\f[R] [\f[B]\f[CB]-w\f[B]\f[R] <time>] [\f[B]\f[CB]-f\f[B]\f[R]] <system>
Restarts all services in the specified system.
By default, the command waits for the system has been completely
restarted.
.RS
.PP
\f[C]-w\f[R] option is used to unconditionally release execution flow
after the time is out even in case system is still (re)starting.
The time value has to be specified in human readable form like
\f[C]1h\f[R] or \f[C]1m 30s\f[R].
The following abbreviations are supported: w, d, h, m, s.
Default value is 61 minutes.
.PP
\f[C]-f\f[R] forcibly shuts down the services when stopping and command
to be executed in non-interactive mode (no confirmations are requested
from a user).
.RE
.TP
\f[B]\f[CB]tbsystem upgrade\f[B]\f[R] [\f[B]\f[CB]-n\f[B]\f[R]] <system> <package>
Performs an upgrade of the system to the specified package.
The package argument corresponds to the platform to upgrade to.
For connectivity components, latest connectivity release compatible with
specified platform is used.
.RS
.PP
\f[C]-n\f[R] option disables execution of \f[C]tbsystemvalidate\f[R].
.RE
.TP
\f[B]\f[CB]tbsystem history\f[B]\f[R]
Displays the history of all \f[C]tbsystem\f[R] commands successfully
issued that affect persisted state.
The history output provides information on from which node, what user,
and what command was issued at what point in time.
.SH EXAMPLES
.PP
\f[B]Creating a Tbricks system with a set of essential components\f[R]
.IP
.nf
\f[C]
     $ tbsystem create sys1 tbricks-2.13.2.64 node1
     Creating system \[dq]sys1\[dq]: OK
     Creating component \[dq]prd_mx1\[dq] of type \[dq]Metadata\[dq] on node \[dq]node1\[dq]: OK
     Creating component \[dq]prd_tp1\[dq] of type \[dq]Trade Persistence\[dq] on node \[dq]node1\[dq]: OK
     Creating component \[dq]prd_op1\[dq] of type \[dq]Order Persistence\[dq] on node \[dq]node1\[dq]: OK
     ...
\f[R]
.fi
.PP
\f[B]Creating an empty Tbricks system\f[R]
.IP
.nf
\f[C]
     $ tbsystem create sys2
     Creating system \[dq]sys2\[dq]: OK
\f[R]
.fi
.PP
\f[B]Destroying a system\f[R]
.IP
.nf
\f[C]
   $ tbsystem destroy sys2
   Destroying system \[dq]sys2\[dq]: OK
\f[R]
.fi
.PP
\f[B]Destroying a system\f[R]
.IP
.nf
\f[C]
   $ tbsystem destroy sys1
   Destroying system \[dq]sys1\[dq]: Failed: Cannot destroy system \[dq]sys1\[dq] : System has one or more components
\f[R]
.fi
.PP
\f[B]Listing all available systems\f[R]
.IP
.nf
\f[C]
   $ tbsystem list
   Shortname      Status            Version                 Description       
------------------------------------------------------------------------------
      rfq         Running      tbricks-2.14.3.142              RFQ
    rfq_dev       Running      tbricks-2.14.6.99          RFQ development     
    rfq_nr        Running      tbricks-2.14.5.188        RFQ next release     
    rfq_tst       Running      tbricks-2.14.6.98       RFQ automated testing  
------------------------------------------------------------------------------
\f[R]
.fi
.PP
\f[B]Setting a system property\f[R]
.IP
.nf
\f[C]
   $ tbsystem set name=\[dq]Production\[dq] sys1
   Updating system \[dq]sys1\[dq] properties: OK
\f[R]
.fi
.PP
\f[B]Getting a system property\f[R]
.IP
.nf
\f[C]
   $ tbsystem get name sys1
   name : Production
\f[R]
.fi
.PP
\f[B]Getting all system properties\f[R]
.IP
.nf
\f[C]
   $ tbsystem get sys1
                  short_name : sys1
                  identifier : 416c201e-3b39-11e9-b210-a72e6f9a978d
                     version : tbricks-2.13.2.64
                 description : Production system for proprietary desk
         log_level_persisted : status
                        name : Production
                       state : Running
\f[R]
.fi
.PP
\f[B]Starting all services in a given system\f[R]
.IP
.nf
\f[C]
   $ tbsystem start sys1
   $
\f[R]
.fi
.PP
\f[B]Stopping all services in a given system\f[R]
.IP
.nf
\f[C]
   $ tbsystem stop sys1
   $
\f[R]
.fi
.SH EXIT STATUS
.PP
The following exit values are returned:
.IP \[bu] 2
0: Successful completion.
.IP \[bu] 2
1: An error occurred.
.IP \[bu] 2
2: Invalid command line options were specified.
.SH SEE ALSO
.PP
\f[C]tbintro\f[R](1), \f[C]tbaudit\f[R](1), \f[C]tbcomponent\f[R](1),
\f[C]tbcore\f[R](1), \f[C]tblog\f[R](1), \f[C]tbnode\f[R](1),
\f[C]tbrelease\f[R](1), \f[C]tbresource\f[R](1), \f[C]tbservice\f[R](1),
\f[C]tbsubsystem\f[R](1), \f[C]tbsystem\f[R](1), \f[C]tbuser\f[R](1)
